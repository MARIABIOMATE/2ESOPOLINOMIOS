<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ejercicios de Polinomios - 2Âº ESO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @media print {
            .no-print { display: none !important; }
            body { background: white !important; }
        }
        .sup { 
            vertical-align: super; 
            font-size: 0.75em; 
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-purple-50">
    <div id="app"></div>

    <script>
        // Datos de los ejercicios
        const exercises = [
            {
                id: 1,
                type: "Suma de polinomios",
                question: "(3xÂ² + 5x - 2) + (2xÂ² - 3x + 7)",
                correct: "5xÂ² + 2x + 5",
                options: [
                    "5xÂ² + 2x + 5",
                    "5xÂ² + 2x + 9",
                    "5xÂ² + 8x + 5",
                    "6xÂ² + 2x + 5"
                ],
                color: "from-blue-400 to-blue-600",
                bgColor: "bg-blue-50",
                borderColor: "border-blue-300"
            },
            {
                id: 2,
                type: "Suma de polinomios",
                question: "(4xÂ³ - xÂ² + 6) + (xÂ³ + 3xÂ² - 2x + 1)",
                correct: "5xÂ³ + 2xÂ² - 2x + 7",
                options: [
                    "5xÂ³ + 2xÂ² - 2x + 7",
                    "5xÂ³ + 2xÂ² + 2x + 7",
                    "5xÂ³ - 2xÂ² - 2x + 7",
                    "3xÂ³ + 2xÂ² - 2x + 7"
                ],
                color: "from-purple-400 to-purple-600",
                bgColor: "bg-purple-50",
                borderColor: "border-purple-300"
            },
            {
                id: 3,
                type: "Resta de polinomios",
                question: "(5xÂ² + 4x - 3) - (2xÂ² + x - 5)",
                correct: "3xÂ² + 3x + 2",
                options: [
                    "3xÂ² + 3x + 2",
                    "3xÂ² + 3x - 8",
                    "3xÂ² + 5x + 2",
                    "7xÂ² + 3x + 2"
                ],
                color: "from-green-400 to-green-600",
                bgColor: "bg-green-50",
                borderColor: "border-green-300"
            },
            {
                id: 4,
                type: "Resta de polinomios",
                question: "(3xÂ³ + 2xÂ² - x + 8) - (xÂ³ - 4xÂ² + 3x - 2)",
                correct: "2xÂ³ + 6xÂ² - 4x + 10",
                options: [
                    "2xÂ³ + 6xÂ² - 4x + 10",
                    "2xÂ³ + 6xÂ² + 2x + 10",
                    "2xÂ³ - 2xÂ² - 4x + 10",
                    "4xÂ³ + 6xÂ² - 4x + 10"
                ],
                color: "from-pink-400 to-pink-600",
                bgColor: "bg-pink-50",
                borderColor: "border-pink-300"
            },
            {
                id: 5,
                type: "Monomio por polinomio",
                question: "3x Â· (2xÂ² - 4x + 5)",
                correct: "6xÂ³ - 12xÂ² + 15x",
                options: [
                    "6xÂ³ - 12xÂ² + 15x",
                    "6xÂ³ - 12xÂ² + 5x",
                    "6xÂ² - 12x + 15x",
                    "6xÂ³ + 12xÂ² + 15x"
                ],
                color: "from-orange-400 to-orange-600",
                bgColor: "bg-orange-50",
                borderColor: "border-orange-300"
            },
            {
                id: 6,
                type: "MultiplicaciÃ³n de polinomios",
                question: "(2x + 1) Â· (xÂ³ - xÂ² + 2x - 3)",
                correct: "2xâ´ - xÂ³ + 3xÂ² - 4x - 3",
                options: [
                    "2xâ´ - xÂ³ + 3xÂ² - 4x - 3",
                    "2xâ´ + xÂ³ + 3xÂ² - 4x - 3",
                    "2xâ´ - xÂ³ - 3xÂ² - 4x - 3",
                    "2xâ´ - xÂ³ + 3xÂ² + 4x - 3"
                ],
                color: "from-red-400 to-red-600",
                bgColor: "bg-red-50",
                borderColor: "border-red-300"
            },
            {
                id: 7,
                type: "Polinomio entre monomio",
                question: "(12xâ´ - 18xÂ³ + 6xÂ²) : 6xÂ²",
                correct: "2xÂ² - 3x + 1",
                options: [
                    "2xÂ² - 3x + 1",
                    "2xÂ² + 3x + 1",
                    "2x - 3x + 1",
                    "2xÂ² - 3x - 1"
                ],
                color: "from-teal-400 to-teal-600",
                bgColor: "bg-teal-50",
                borderColor: "border-teal-300"
            },
            {
                id: 8,
                type: "DivisiÃ³n de polinomios",
                question: "(xÂ³ - 2xÂ² - 5x + 6) : (x - 3)",
                correct: "xÂ² + x - 2",
                options: [
                    "xÂ² + x - 2",
                    "xÂ² - x - 2",
                    "xÂ² + x + 2",
                    "xÂ² - x + 2"
                ],
                color: "from-indigo-400 to-indigo-600",
                bgColor: "bg-indigo-50",
                borderColor: "border-indigo-300"
            }
        ];

        // Estado de la aplicaciÃ³n
        let state = {
            studentName: '',
            currentExercise: 0,
            answers: {},
            showWelcome: true,
            finished: false
        };

        // Convertir exponentes a superÃ­ndices
        function formatExpression(expr) {
            return expr
                .replace(/xÂ²/g, 'x<span class="sup">2</span>')
                .replace(/xÂ³/g, 'x<span class="sup">3</span>')
                .replace(/xâ´/g, 'x<span class="sup">4</span>')
                .replace(/xâµ/g, 'x<span class="sup">5</span>')
                .replace(/\^2/g, '<span class="sup">2</span>')
                .replace(/\^3/g, '<span class="sup">3</span>')
                .replace(/\^4/g, '<span class="sup">4</span>');
        }

        // Barajar opciones
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        // Renderizar pantalla de bienvenida
        function renderWelcome() {
            return `
                <div class="min-h-screen flex items-center justify-center p-4">
                    <div class="bg-white rounded-3xl shadow-2xl p-8 md:p-12 max-w-md w-full">
                        <div class="text-center mb-8">
                            <div class="text-6xl mb-4">ğŸ“</div>
                            <h1 class="text-3xl font-bold text-gray-800 mb-2">Polinomios 2Âº ESO</h1>
                            <p class="text-gray-600">Ejercicios Interactivos</p>
                        </div>
                        
                        <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl p-6 mb-6">
                            <p class="text-sm text-gray-700 mb-2">ğŸ“š <strong>8 ejercicios</strong></p>
                            <p class="text-sm text-gray-700 mb-2">âœï¸ Sumas, restas, multiplicaciones y divisiones</p>
                            <p class="text-sm text-gray-700">ğŸ“Š Informe final descargable</p>
                        </div>

                        <div class="mb-6">
                            <label class="block text-gray-700 font-medium mb-2">Tu nombre completo:</label>
                            <input 
                                type="text" 
                                id="studentName" 
                                placeholder="Introduce tu nombre y apellidos"
                                class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none text-lg"
                                onkeypress="if(event.key === 'Enter') startExercises()"
                            >
                        </div>

                        <button 
                            onclick="startExercises()"
                            class="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white font-bold py-4 rounded-xl hover:from-blue-600 hover:to-purple-700 transition-all transform hover:scale-105 shadow-lg"
                        >
                            Comenzar Ejercicios â†’
                        </button>
                    </div>
                </div>
            `;
        }

        // Renderizar ejercicio actual
        function renderExercise() {
            const ex = exercises[state.currentExercise];
            const shuffledOptions = shuffleArray(ex.options);
            const progress = ((state.currentExercise + 1) / exercises.length * 100).toFixed(0);

            return `
                <div class="min-h-screen p-4 md:p-8">
                    <div class="max-w-4xl mx-auto">
                        <!-- Header -->
                        <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <h2 class="text-2xl font-bold text-gray-800">ğŸ‘¤ ${state.studentName}</h2>
                                    <p class="text-gray-600">Ejercicio ${state.currentExercise + 1} de ${exercises.length}</p>
                                </div>
                                <div class="text-right">
                                    <p class="text-3xl font-bold bg-gradient-to-r ${ex.color} bg-clip-text text-transparent">
                                        ${state.currentExercise + 1}/8
                                    </p>
                                </div>
                            </div>
                            
                            <!-- Barra de progreso -->
                            <div class="w-full bg-gray-200 rounded-full h-3">
                                <div class="bg-gradient-to-r ${ex.color} h-3 rounded-full transition-all duration-500" style="width: ${progress}%"></div>
                            </div>
                        </div>

                        <!-- Ejercicio -->
                        <div class="bg-white rounded-2xl shadow-2xl p-8 ${ex.bgColor} border-4 ${ex.borderColor}">
                            <div class="mb-6">
                                <span class="bg-gradient-to-r ${ex.color} text-white px-4 py-2 rounded-full text-sm font-bold">
                                    ${ex.type}
                                </span>
                            </div>

                            <div class="mb-8">
                                <p class="text-gray-600 font-medium mb-3">Resuelve:</p>
                                <div class="bg-white rounded-xl p-6 border-2 border-gray-200">
                                    <p class="text-3xl font-bold text-center text-gray-800">
                                        ${formatExpression(ex.question)}
                                    </p>
                                </div>
                            </div>

                            <div class="space-y-4">
                                <p class="text-gray-700 font-medium mb-4">Selecciona la respuesta correcta:</p>
                                ${shuffledOptions.map((option, idx) => `
                                    <button 
                                        onclick="checkAnswer('${option}')"
                                        class="w-full p-5 text-left border-3 border-gray-300 rounded-xl hover:border-gray-400 hover:bg-gray-50 transition-all transform hover:scale-105 bg-white shadow-md"
                                    >
                                        <div class="flex items-center gap-4">
                                            <span class="flex-shrink-0 w-10 h-10 rounded-full bg-gradient-to-r ${ex.color} text-white flex items-center justify-center font-bold text-lg">
                                                ${String.fromCharCode(65 + idx)}
                                            </span>
                                            <span class="text-xl font-medium text-gray-800">
                                                ${formatExpression(option)}
                                            </span>
                                        </div>
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Renderizar resultado final
        function renderResults() {
            const correct = Object.values(state.answers).filter(a => a.correct).length;
            const incorrect = exercises.length - correct;
            const percentage = ((correct / exercises.length) * 100).toFixed(1);

            return `
                <div class="min-h-screen p-4 md:p-8">
                    <div class="max-w-4xl mx-auto">
                        <div class="bg-white rounded-3xl shadow-2xl p-8 md:p-12">
                            <div class="text-center mb-8">
                                <div class="text-6xl mb-4">${correct === exercises.length ? 'ğŸ†' : correct >= 6 ? 'ğŸ‰' : 'ğŸ“š'}</div>
                                <h2 class="text-4xl font-bold text-gray-800 mb-2">Â¡Has terminado!</h2>
                                <p class="text-xl text-gray-600">Alumno: ${state.studentName}</p>
                            </div>

                            <!-- EstadÃ­sticas -->
                            <div class="grid md:grid-cols-3 gap-4 mb-8">
                                <div class="bg-green-50 rounded-xl p-6 text-center border-2 border-green-200">
                                    <div class="text-4xl font-bold text-green-600 mb-2">${correct}</div>
                                    <div class="text-sm text-gray-600">Correctas âœ“</div>
                                </div>
                                <div class="bg-red-50 rounded-xl p-6 text-center border-2 border-red-200">
                                    <div class="text-4xl font-bold text-red-600 mb-2">${incorrect}</div>
                                    <div class="text-sm text-gray-600">Incorrectas âœ—</div>
                                </div>
                                <div class="bg-blue-50 rounded-xl p-6 text-center border-2 border-blue-200">
                                    <div class="text-4xl font-bold text-blue-600 mb-2">${percentage}%</div>
                                    <div class="text-sm text-gray-600">Acierto</div>
                                </div>
                            </div>

                            <!-- Desglose por ejercicio -->
                            <div class="mb-8">
                                <h3 class="text-2xl font-bold text-gray-800 mb-4">ğŸ“‹ Desglose de Ejercicios</h3>
                                <div class="space-y-3">
                                    ${exercises.map((ex, idx) => {
                                        const answer = state.answers[idx];
                                        const isCorrect = answer && answer.correct;
                                        return `
                                            <div class="p-4 rounded-xl border-2 ${isCorrect ? 'bg-green-50 border-green-300' : 'bg-red-50 border-red-300'}">
                                                <div class="flex items-start gap-3">
                                                    <span class="text-2xl">${isCorrect ? 'âœ…' : 'âŒ'}</span>
                                                    <div class="flex-1">
                                                        <p class="font-bold text-gray-800 mb-1">
                                                            Ejercicio ${idx + 1}: ${ex.type}
                                                        </p>
                                                        <p class="text-sm text-gray-600 mb-2">${formatExpression(ex.question)}</p>
                                                        <div class="flex gap-4 text-sm">
                                                            <span class="${isCorrect ? 'text-green-700' : 'text-red-700'} font-medium">
                                                                Tu respuesta: ${formatExpression(answer.selected)}
                                                            </span>
                                                            ${!isCorrect ? `<span class="text-green-700 font-medium">
                                                                Correcta: ${formatExpression(ex.correct)}
                                                            </span>` : ''}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            </div>

                            <!-- Botones -->
                            <div class="flex gap-4 flex-wrap">
                                <button 
                                    onclick="downloadResults()"
                                    class="flex-1 min-w-[200px] bg-gradient-to-r from-green-500 to-green-600 text-white font-bold py-4 px-6 rounded-xl hover:from-green-600 hover:to-green-700 transition-all shadow-lg"
                                >
                                    ğŸ“¥ Descargar Informe Completo
                                </button>
                                <button 
                                    onclick="restart()"
                                    class="flex-1 min-w-[200px] bg-gradient-to-r from-blue-500 to-purple-600 text-white font-bold py-4 px-6 rounded-xl hover:from-blue-600 hover:to-purple-700 transition-all shadow-lg"
                                >
                                    ğŸ”„ Volver a Intentar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Funciones de control
        window.startExercises = function() {
            const nameInput = document.getElementById('studentName');
            if (nameInput && nameInput.value.trim()) {
                state.studentName = nameInput.value.trim();
                state.showWelcome = false;
                render();
            } else {
                alert('Por favor, introduce tu nombre');
            }
        };

        window.checkAnswer = function(selectedAnswer) {
            const ex = exercises[state.currentExercise];
            const isCorrect = selectedAnswer === ex.correct;
            
            state.answers[state.currentExercise] = {
                correct: isCorrect,
                selected: selectedAnswer
            };

            if (isCorrect) {
                showFeedback('Â¡Correcto! âœ“', 'green', () => {
                    nextExercise();
                });
            } else {
                showFeedback('Incorrecto âœ—<br><small>Deben preguntarlo en clase para aprender a hacerlo</small>', 'red', () => {
                    nextExercise();
                });
            }
        };

        function showFeedback(message, color, callback) {
            const bgColor = color === 'green' ? 'bg-green-500' : 'bg-red-500';
            const overlay = document.createElement('div');
            overlay.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            overlay.innerHTML = `
                <div class="${bgColor} text-white rounded-2xl p-8 max-w-md text-center shadow-2xl transform scale-0 transition-transform" id="feedbackBox">
                    <div class="text-6xl mb-4">${color === 'green' ? 'âœ“' : 'âœ—'}</div>
                    <p class="text-2xl font-bold">${message}</p>
                </div>
            `;
            document.body.appendChild(overlay);
            
            setTimeout(() => {
                document.getElementById('feedbackBox').style.transform = 'scale(1)';
            }, 10);

            setTimeout(() => {
                overlay.remove();
                callback();
            }, 2000);
        };

        function nextExercise() {
            if (state.currentExercise < exercises.length - 1) {
                state.currentExercise++;
                render();
            } else {
                state.finished = true;
                render();
            }
        };

        window.downloadResults = function() {
            const correct = Object.values(state.answers).filter(a => a.correct).length;
            const incorrect = exercises.length - correct;
            const percentage = ((correct / exercises.length) * 100).toFixed(1);
            
            let content = `
INFORME DE EJERCICIOS DE POLINOMIOS - 2Âº ESO
============================================

Alumno: ${state.studentName}
Fecha: ${new Date().toLocaleDateString('es-ES')}

RESUMEN:
--------
Total de ejercicios: ${exercises.length}
Correctas: ${correct}
Incorrectas: ${incorrect}
Porcentaje de acierto: ${percentage}%

DESGLOSE POR EJERCICIO:
-----------------------

`;

            exercises.forEach((ex, idx) => {
                const answer = state.answers[idx];
                const isCorrect = answer && answer.correct;
                content += `
Ejercicio ${idx + 1}: ${ex.type}
Enunciado: ${ex.question}
Estado: ${isCorrect ? 'CORRECTA âœ“' : 'INCORRECTA âœ—'}
Tu respuesta: ${answer.selected}
Respuesta correcta: ${ex.correct}
${!isCorrect ? 'âš ï¸ Deben preguntarlo en clase para aprender a hacerlo\n' : ''}
-------------------
`;
            });

            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Informe_Polinomios_${state.studentName.replace(/\s+/g, '_')}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        };

        window.restart = function() {
            state = {
                studentName: state.studentName,
                currentExercise: 0,
                answers: {},
                showWelcome: false,
                finished: false
            };
            render();
        };

        // Renderizar aplicaciÃ³n
        function render() {
            const app = document.getElementById('app');
            if (state.showWelcome) {
                app.innerHTML = renderWelcome();
            } else if (state.finished) {
                app.innerHTML = renderResults();
            } else {
                app.innerHTML = renderExercise();
            }
        }

        // Iniciar aplicaciÃ³n
        document.addEventListener('DOMContentLoaded', render);
    </script>
</body>
</html>